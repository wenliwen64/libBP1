%clear all;
close all;

figure(50);
nel=12;



r(:,1)=[-371 -298 -192 -23 0 23 177 213 260 98 -72 -131 ]/1000;
r(:,2)=[-302 -208 -284 -13 0 -9 98 235 411 213 328 393 ]/1000;
p6lat=35+49.435/60;
p6lon=-(120+30.185/60);
    rx0=distance(p6lat,-121,p6lat,p6lon)*pi/180*6371;
    ry0=distance(35,p6lon,p6lat,p6lon)*pi/180*6371;
hold on;
for i=1:nel
    plot(rx0+r(i,1),ry0+r(i,2),'.');
end

eqlat=[35.85 35.90 35.79 35.99   35.847896        35.924160 35.924061  35.921650    35.921240    35.954852   35.954852 35.937644 35.935492  ]
eqlon=[-120.39 -120.44 -120.34 -120.54 -120.398245 -120.473683 -120.475471 -120.477019 -120.477273  -120.511883 -120.511883 -120.489256 -120.486675]



    rx=distance(eqlat,-121,eqlat,eqlon)*pi/180*6371;
    ry=distance(35,eqlon,eqlat,eqlon)*pi/180*6371;
    
    
day=[282 291 276 274    319                   275.1849    275.1855  275.1326     275.1329          309.1728 309.1358 296.0421 296.0752]
toa=[103.2 112 113.8 104.8 114.6 106 105 102 100.8 124.2 124.1 104.2 104]
depth=[4.5 5.9 9.6 8.7 6.2 4.4 4.7 5.2 5.0 12.885 12.845 5.494 5.372]
  %oct 8 oct17
 plot(rx,ry,'r*');
 plot(rx,-1.1654*rx+157.7984,'-');
for i=1:length(eqlat)
    text(rx(i),ry(i),num2str(day(i)));
end
% for i=1:nel
%     plot(-120.3+r(i,1)/11,35.75+r(i,2)/11,'.');
%     if i>=4
%     text(-120.3+r(i,1)/11,35.75+r(i,2)/11,num2str(i+1));
%     else
%     text(-120.3+r(i,1)/11,35.75+r(i,2)/11,num2str(i)); 
%     end
% end

%xlim([-120.6 -120.2]);
%ylim([35.7 36]);
%toa=[104.8411  124.2511  124.1459  104.2272  104.0280  105.0622  106.0745  102.7753  100.8748  112.0291  103.2134  114.5993  113.8133];
   theta=atan2(rx-rx0,ry-ry0)/pi*180;
   dist=((rx-rx0).^2+(ry-ry0).^2).^0.5; 
   
   x=RadiationPattern(-50,90,0,toa,theta);
    
    ra=x(:,2)./x(:,3);
    
%     for i=1:length(eqlat)
%     text(rx(i)+5,ry(i),num2str(ra(i)));
%     end
   axis equal
   
   rrr=[ra'; theta; dist;day;depth;toa]'
   rrr1=sortrows(rrr,2);
   abs(rrr1(:,1))
    rrr1